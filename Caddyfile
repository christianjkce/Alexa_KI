{
  email {$ACME_EMAIL}
}

{$APP_HOST} {
  encode gzip

  @health {
    path /health
  }
  handle @health {
    reverse_proxy app:3000
  }

  handle {
    reverse_proxy app:3000 {
      header_up Host {http.reverse_proxy.upstream.hostport}
    }
  }

  log {
    output file /var/log/caddy/access.log
    format json
  }

  tls {
    alpn http/1.1 h2
  }
}
